<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    </head>
    <body>
        <button type="Button" id="Sort">Sort</button>
        <br></br>
        <script type="text/javascript">
            d3.json("medals.json", function(data){
                //data is an array of objects
                var w = 800;
                var h = 1600;

                dataset=[];
                for( var i =0; i<data.length; i++){
                    if (data[i].Year=="Total"){
                        
                        var new_data = data[i]
                        new_data.TotalMedals=new_data.Bronze + new_data.Silver + new_data.Gold;
                        dataset.push(new_data)
                    }
                }


                function sortTotal(list){

                    list.sort(function (a,b) {

                        if (a.TotalMedals < b.TotalMedals)
                            return -1;
                        if (a.TotalMedals > b.TotalMedals)
                            return 1;
                        return 0;

                    })


                };

                function sortAlpha(list){
                    list.sort(function (a,b) {

                        if (a.Country < b.Country)
                            return -1;
                        if (a.Country > b.Country)
                            return 1;
                        return 0;

                    })


                };

                


                // var dataset_keys = Object.keys(dataset);
                // var dataset_sorted_alpha =[];
                // dataset_keys.sort();
                // for  (var i=0; i<dataset_keys.length; i++){
                //     var key = dataset_keys[i];
                    
                //     dataset_sorted_alpha.push(dataset[key]);


                // }


                var xScale = d3.scale.linear()
                            .domain([0,d3.max(dataset.map(function(d){
                                                return d.TotalMedals
                            }))])
                            .range( [ 0 ,w ], 0.02);

                var svg = d3.select("body").append("svg")
                            .attr("width",w)
                            .attr("height",h);

                var buttonSort = d3.select("#Sort")
                                .on("click", function(){
                                    sortBars();
                                });
                              
                var bronzeBars = svg.append("g");

                var silverBars = svg.append("g");      

                var goldBars = svg.append("g");                                
                function update(medalData){


                    bronzeBars.selectAll("rect")
                        .data(dataset)
                        .enter()
                        .append("rect")
                        .attr("x",0)
                        .attr("y", function(d,i){
                            return i* (h/dataset.length) 
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Bronze )
                        })
                        .attr("height",function(d,i){
                            return h / dataset.length;
                        })
                        .attr("fill","#905923")
                        .transition()
              
                        .attr("class",function (d){
                            return d.Country +"Bronze"
                        })

                        .attr("dataum", function(d){
                            return d.Bronze
                        });
                        
                    silverBars.selectAll("rect")
                        .data(dataset)
                        .enter()
                        .append("rect")
                        .attr("x",function(d,i){
                            return xScale(d.Bronze)
                        })
                        .attr("y", function(d,i){
                            return i* (h/dataset.length) 
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Silver )
                        })
                        .attr("height",function(d,i){
                            return h / dataset.length;
                        })
                        .attr("fill","#D3D3D3")
                        .transition()
              
                        .attr("class",function (d){
                            return d.Country +"Silver"
                        });

                    goldBars.selectAll("rect")
                        .data(dataset)
                        .enter()
                        .append("rect")

                        .attr("x",function(d,i){
                            return xScale(d.Bronze) + xScale(d.Silver)
                        })
                        .attr("y", function(d,i){
                            return i* (h/dataset.length) 
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Gold )
                        })
                        .attr("height",function(d,i){
                            return h / dataset.length;
                        })
                        .attr("fill","#ffd700")
                        .transition()
             
                        .attr("class",function (d){
                            return d.Country +"Gold"
                        });


                    svg.selectAll("text")
                        .data(dataset)
                        .enter()
  
                        .append("text")
                        .text(function(d){
                            return d.Country;
                        })
                        .transition()
                 
                        .attr("x",5)
                        .attr("y",function (d,i){
                            return i*(h / dataset.length) +20;
                        })
                        .attr("font-family","sans-serif")
                        .attr("font-size","11px")
                        .attr("fill","black");
                        
                    // svg.append("g")
                    //     .attr("class","x axis")
                    //     .attr("translate(0," + h +")")
                    //     .call(d3.svg.axis().scale(xScale).orient("bottom"));
                    }



                    update(dataset);

                    function sortBars(){
                        sortTotal(dataset);
                        update(dataset);


                    }
                    // var sortedAlpha = false;

                    // var sortBars = function(){
                    //     svg.selectAll("rect")
                    //        .sort(function(a,b){
                    //          if(!sortedAlpha){
                                    
                    //                 return d3.ascending((a.Bronze + 
                    //                                     a.Silver +
                    //                                     a.Gold),(b.Bronze + 
                    //                                             b.Silver +
                    //                                             b.Gold));
                               
                    //         }
                    //     })
                    //     .transition()
                    //     .delay(function(d,i){
                    //         return i*50;
                    //     })
                    //     .duration(1000)
                    //     // .attr("x", function(d,i){
                    //     //     return xScale(i);
                    //     // })
                    // };
                       
                


            
            });
            
        </script>
    </body>
</html>