<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style type="text/css">
        svg{
            display: block;
            margin-left:auto;
            margin-right: auto;
        }

        .axis text {
          font: 10px sans-serif;
        }

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

    </style>
    </head>
    <body>
        <button type="Button" id="Sort">Sort</button>
        <br></br>

        <script type="text/javascript">
            d3.json("medals.json", function(data){
                //data is an array of objects

                dataset=[];
                for( var i =0; i<data.length; i++){
                    if (data[i].Year=="Total"){
                        
                        var new_data = data[i]
                        new_data.TotalMedals=new_data.Bronze + new_data.Silver + new_data.Gold;
                        dataset.push(new_data)
                    }
                }


                function sortTotal(list){

                    list.sort(function (a,b) {

                        if (a.TotalMedals < b.TotalMedals)
                            return 1;
                        if (a.TotalMedals > b.TotalMedals)
                            return -1;
                        return 0;

                    })


                };

                function sortAlpha(list){
                    list.sort(function (a,b) {

                        if (a.Country < b.Country)
                            return -1;
                        if (a.Country > b.Country)
                            return 1;
                        return 0;

                    })


                };

                var sortedAlpha = new Boolean(true); //dataset starts in alpha order

  
                function drawInitial(medalData){
                    d3.selectAll("svg").remove();   

                    var w = 1200;
                    var h = 1600;

                    var textPadding = 200
                    var scalePadding = 25
                    var xScale = d3.scale.linear()
                                .domain([0,d3.max(dataset.map(function(d){
                                                    return d.TotalMedals
                                }))])
                                .range( [ 0 ,w-textPadding-20 ], 0.02);

                    var svg = d3.select("body").append("svg")
                                .attr("width",w)
                                .attr("height",h);

                    var buttonSort = d3.select("#Sort")
                                    .on("click", function(){
                                        sortBars();
                                    });
                                  
                    var bronzeBars = svg.append("g");

                    var silverBars = svg.append("g");  

                    var goldBars = svg.append("g");                         

                    var barPadding = 3;

                    var xAxis   = d3.svg.axis().scale(xScale).orient("top");
           


                    bronzeBars.selectAll("rect")
                        .data(dataset)
                        .enter()
                        .append("rect")
                        .attr("x",textPadding)
                        .attr("y", function(d,i){
                            return i* ((h-scalePadding)/dataset.length) + scalePadding
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Bronze )
                        })
                        .attr("height",function(d,i){
                            return h / dataset.length - barPadding;
                        })
                        .attr("fill","#905923")
                        .transition()
              
                        .attr("id",function (d){
                            return d.Country +"Bronze"
                        })
                        .attr("class", function(d){
                            return d.Country
                        })
                        .attr("dataum", function(d){
                            return d.Bronze
                        });
                            
                        silverBars.selectAll("rect")
                            .data(dataset)
                            .enter()
                            .append("rect")
                            .attr("x",function(d,i){
                                return xScale(d.Bronze)+textPadding
                            })
                            .attr("y", function(d,i){
                                return i* ((h-scalePadding)/dataset.length) + scalePadding
                            })
                            .attr("width", function(d,i){
                                
                                return xScale(d.Silver )
                            })
                            .attr("height",function(d,i){
                                return h / dataset.length - barPadding;
                            })
                            .attr("fill","#D3D3D3")
                            .transition()
                            .attr("id",function (d){
                                return d.Country +"Silver"
                            })
                            .attr("class",function (d){
                                return d.Country 

                            })
                            .attr("dataum", function(d){
                                return d.Silver
                            });                        ;

                        goldBars.selectAll("rect")
                            .data(dataset)
                            .enter()
                            .append("rect")

                            .attr("x",function(d,i){
                                return xScale(d.Bronze) + xScale(d.Silver)+textPadding
                            })
                            .attr("y", function(d,i){
                                return i* ((h-scalePadding)/dataset.length) + scalePadding
                            })
                            .attr("width", function(d,i){
                                
                                return xScale(d.Gold )
                            })
                            .attr("height",function(d,i){
                                return h / dataset.length - barPadding;
                            })
                            .attr("fill","#ffd700")
                            .transition()
                 
                            .attr("id",function (d){
                                return d.Country +"Gold"
                            })
                            .attr("class",function (d){
                                return d.Country 

                            })
                            .attr("dataum", function(d){
                                return d.Gold
                            });                             


                        svg.selectAll("text")
                            .data(dataset)
                            .enter()
      
                            .append("text")
                            .text(function(d){
                                return d.Country;
                            })
                            .transition()
                     
                            .attr("x",0)
                            .attr("y",function (d,i){
                                return i*((h -scalePadding) / dataset.length) +scalePadding +20;
                            })
                            .attr("font-family","Georgia")
                            .attr("font-size","14px")
                            .attr("fill","black");

                        svg.append("g")
                            .attr("class","x axis")
                             .attr("transform", "translate ("+textPadding+",20)")
                            .call(xAxis);
                            

                        svg.selectAll("rect")
                                .on("click", function(){
                                    var country = this.getAttribute("class");

                                    getCountryMedalData(country);

                        
                                });
                }

                    function update(){

                        bronzeBars.selectAll("rect")
                        .data(dataset)
                        .transition()
                        .attr("x",textPadding)
                        .attr("y", function(d,i){
                            return i* ((h-scalePadding)/dataset.length) + scalePadding
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Bronze )
                        })
                        // .attr("height",function(d,i){
                        //     return h / dataset.length;
                        // })
                        // .attr("fill","#905923")

              
                        .attr("id",function (d){
                            return d.Country +"Bronze"
                        })
                        .attr("class",function (d){
                            return d.Country 

                        })

                        .attr("dataum", function(d){
                            return d.Bronze
                        });
                        
                    silverBars.selectAll("rect")
                        .data(dataset)
                        .transition()
                        .attr("x",function(d,i){
                            return xScale(d.Bronze) +textPadding
                        })
                        .attr("y", function(d,i){
                            return i* ((h-scalePadding)/dataset.length) + scalePadding
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Silver )
                        })
                        // .attr("height",function(d,i){
                        //     return h / dataset.length;
                        // })
                        .attr("id",function (d){
                            return d.Country +"Silver"
                        })
                        .attr("class",function (d){
                            return d.Country 

                        })
                        .attr("dataum", function(d){
                            return d.Silver
                        });                        ;

                    goldBars.selectAll("rect")
                        .data(dataset)
                        .transition()
                        .attr("x",function(d,i){
                            return xScale(d.Bronze) + xScale(d.Silver) +textPadding
                        })
                        .attr("y", function(d,i){
                            return i* ((h-scalePadding)/dataset.length) + scalePadding
                        })
                        .attr("width", function(d,i){
                            
                            return xScale(d.Gold )
                        })
                        // .attr("height",function(d,i){
                        //     return h / dataset.length;
                        // })
                        // .attr("fill","#ffd700")

             
                        .attr("id",function (d){
                            return d.Country +"Gold"
                        })
                        .attr("class",function (d){
                            return d.Country 

                        })
                        .attr("dataum", function(d){
                            return d.Gold
                        });      

                    svg.selectAll("text")
                        .data(dataset)
                        .text(function(d){
                            return d.Country;
                        })
                        .transition()
                        .duration(1000)
                        .attr("y",function (d,i){
                            return i*((h -scalePadding) / dataset.length) +scalePadding +20;
                        })
                        // .attr("font-family","sans-serif")
                        // .attr("font-size","11px")
                        // .attr("fill","black");

                    }


                    drawInitial(dataset);

                    function sortBars(){
                        if (sortedAlpha){
                            sortTotal(dataset); 
                            sortedAlpha = false;                          
                        }else  {
                            sortAlpha(dataset);
                            sortedAlpha = true;

                        }

                        update(dataset);


                    }

                    function getCountryMedalData(country){

                        var medal_dict =[];

                        for( var i =0; i<data.length; i++){
                            if (data[i].Country== country && data[i].Year!="Total"){
                                
                                var medals=[];
                                medals[0]=data[i].Bronze;
                                medals[1]=data[i].Silver;
                                medals[2]=data[i].Gold;

                                medal_dict.push({
                                    key: data[i].Year,
                                    value: medals
                                })
                            }
                        }
                        drawCountryTimeline(medal_dict)

                    }//end of function

                    function drawCountryTimeline(medals){


                        d3.selectAll("svg").remove();

                        var w = 1800;
                        var h = 400;

                        var svg = d3.select("body").append("svg")
                                    .attr("width",w)
                                    .attr("height",h);

                        var yScale = d3.scale.linear()
                                    .domain([0,d3.max(medals.map(function(d,i){
                                                        
                                                        return d.value[0] +
                                                        d.value[1] +
                                                        d.value[2]
                                    }))])
                                    .range( [ 0 ,h ], 0.02);
                        
                        var bronzeBars = svg.append("g");

                        var silverBars = svg.append("g");  

                        var goldBars = svg.append("g");

                        var scalePadding = 20;   

                        var textPadding = 30;      

                        bronzeBars.selectAll("rect")
                            .data(medals)
                            .enter()
                            .append("rect")
                            .attr("x",function (d,i) {
                                return i * ((w - scalePadding)/medals.length) + scalePadding

                            })
                            .attr("y", function(d,i){
                                return h - yScale(d.value[0]) - textPadding;
                            })
                            .attr("width", function(d,i){
                                
                                return 20;
                            })
                            .attr("height",function(d,i){
                                return yScale(d.value[0]);
                            })
                            .attr("fill","#905923")
                            .transition()
                            .attr("class", function(d){
                                return "bronze";
                            });
                        silverBars.selectAll("rect")
                            .data(medals)
                            .enter()
                            .append("rect")
                            .attr("x",function (d,i) {
                                return i * ((w - scalePadding)/medals.length) + scalePadding

                            })
                            .attr("y", function(d,i){
                                return h - yScale(d.value[1])- yScale(d.value[0]) - textPadding;
                            })
                            .attr("width", function(d,i){
                                
                                return 20;
                            })
                            .attr("height",function(d,i){
                                return yScale(d.value[1]) ;
                            })
                            .attr("fill","#D3D3D3")
                            .transition()
                            .attr("class", function(d){
                                return "SilverColor";
                            });

                        goldBars.selectAll("rect")
                            .data(medals)
                            .enter()
                            .append("rect")
                            .attr("x",function (d,i) {
                                return i * ((w - scalePadding)/medals.length) + scalePadding

                            })
                            .attr("y", function(d,i){
                                return h - yScale(d.value[1])- yScale(d.value[0]) - yScale(d.value[2]) - textPadding
                            })
                            .attr("width", function(d,i){
                                
                                return 20;
                            })
                            .attr("height",function(d,i){
                                return yScale(d.value[2]) ;
                            })
                            .attr("fill","#ffd700")
                            .transition()                     
                            .attr("class", function(d){
                                return "gold";
                            });
                            // })
                            // .attr("dataum", function(d){
                            //     return d.Bronze
                            // });

                        svg.selectAll("text")
                            .data(medals)
                            .enter()
      
                            .append("text")
                            .text(function(d){
                                return d.key;
                            })
                            .transition()
                     
                            .attr("x",function (d,i) {
                                return i * ((w - scalePadding)/medals.length) + scalePadding -3

                            })
                            .attr("y",function (d,i){
                                return h-10;
                            })
                            .attr("font-family","Georgia")
                            .attr("font-size","14px")
                            .attr("fill","black");

                        d3.select(svg).on("click", function(){

                            drawInitial(dataset);
                        }); //ALMOST THERE
                                    
                    }

            
        });
        
        </script>
    </body>
</html>